<div class="bftScanner" *ngIf="isAuthorizedCustomer; else outOfAccess">
   <div class="content">
      <div class="top-line">
         <div class="segment-select">
            <mat-form-field floatLabel="never" class="crypto-select full-width bft-form-select">
               <mat-select (selectionChange)="segmentSelected($event.value)" [value]="activeSegment">
                  <mat-option *ngFor="let option of segments" [value]="option">
                     {{option}}
                  </mat-option>
               </mat-select>
            </mat-form-field>
         </div>
         <div class="tf-select">
            <mat-form-field floatLabel="never" class="crypto-select full-width bft-form-select">
               <mat-select (selectionChange)="timeframeSelected($event.value)" [value]="activeTimeframe">
                  <mat-option *ngFor="let option of timeframes" [value]="option">
                     {{option}}
                  </mat-option>
               </mat-select>
            </mat-form-field>
         </div>
         <div class="scanning-time">Last: {{scanningTime}}</div>
      </div>

      <mat-tab-group class="full-height tabs">
         <mat-tab label="Realtime">
            <div class="content-wrapper flex-grow-1 h-0">
               <div class="full-height padding-wrapper">
                  <ng-container *ngFor="let groupedResult of groupedResults(); trackBy: trackByTimeframe">
                     <div *ngIf="dataExistsInGroup(groupedResult)" class="timeframe-container">
                        <div class="timeframe-name">{{groupedResult.timeframe}}</div>
                        <div class="timeframe-wrapper tiles-wrapper w-100">
                           <ng-container *ngFor="let group of groupedResult.data; trackBy: trackByMarketType">
                              <div class="sonar-tile-wrapper"
                                 *ngFor="let result of group.data; trackBy: trackByResult">
                                 <scanner-card [result]="result"></scanner-card>
                              </div>
                           </ng-container>
                        </div>
                     </div>
                  </ng-container>

                  <div *ngIf="output; else subscriptionOutput" class="output">
                     {{output}}
                  </div>

                  <ng-template #subscriptionOutput>
                     <div class="out-of-subscription" *ngIf="!isPro" (click)="manageSubscriptions()">
                        <div class="image">
                           <img class="BFTimage" src="assets/img/bftnavigatorlogo.svg">
                        </div>
                        <div class="text">
                           Upgrade your subscription to get access to all trades.
                        </div>
                     </div>
                  </ng-template>

               </div>
            </div>
         </mat-tab>
         <mat-tab label="History">
            <div class="content-wrapper flex-grow-1 h-0">
               <div class="full-height padding-wrapper">
                  <data-table #dataTableComponent [rows]="scannerHistoryResultsFiltered" [selectable]="true"
                     [expandOnClick]="false" [selectedRow]="selectedScannerResult" [allowColumnsVisibilityChange]="false"
                     (onRowSelect)="handleScannerResultsClick($event, true)">

                     <data-table-header-cell columnName="symbol" [sortable]="true">
                        {{'instrument' | translate}}
                     </data-table-header-cell>
                     <data-table-header-cell columnName="timeframe" [sortable]="false">
                        {{'timeframe' | translate}}
                     </data-table-header-cell>
                     <data-table-header-cell columnName="setup" [sortable]="false">
                        {{'setup' | translate}}
                     </data-table-header-cell>
                     <data-table-header-cell columnName="volume" [sortable]="false">
                        {{'volume' | translate}}
                     </data-table-header-cell>
                     <data-table-header-cell columnName="time" [sortable]="false">
                        {{'time' | translate}}
                     </data-table-header-cell>

                     <data-table-cell columnName="symbol">
                        <ng-template let-scannerVM>
                           <div class="symbol-column cell-data">
                              {{scannerVM.symbol}}
                           </div>
                        </ng-template>
                     </data-table-cell>
                     <data-table-cell columnName="timeframe">
                        <ng-template let-scannerVM>
                           <div class="cell-data">
                              {{toTimeframe(scannerVM.timeframe)}} {{scannerVM.trend == trends.Up ? "Long" : "Short"}}
                           </div>
                        </ng-template>
                     </data-table-cell>
                     <data-table-cell columnName="setup">
                        <ng-template let-scannerVM>
                           <div class="cell-data">
                           <ng-container [ngSwitch]="scannerVM.origType">
                              <ng-container *ngSwitchCase="origType.EXT">
                                 <!-- <img class="svgfiller"  src="assets/img/EXT2.svg"/> -->
                                 <span>EXT</span>
                              </ng-container>
                              <ng-container *ngSwitchCase="origType.BRC">
                                 <!-- <img class="svgfiller"  src="assets/img/BRC2.svg"/> -->
                                 <span>BRC</span>
                              </ng-container>
                              <ng-container *ngSwitchCase="origType.SwingExt">
                                 <!-- <img class="svgfiller"  src="assets/img/SWING2.svg"/> -->
                                 <span>SWING</span>
                              </ng-container>
                              <ng-container *ngSwitchCase="origType.SwingN">
                                 <!-- <img class="svgfiller"  src="assets/img/SWING2.svg"/> -->
                                 <span>SWING</span>
                              </ng-container>
                           </ng-container>
                        </div>
                        </ng-template>
                     </data-table-cell>
                     <data-table-cell columnName="volume">
                        <ng-template let-scannerVM>
                           <div class="cell-data" [ngClass]="{'high':scannerVM.volatility == 'High', 'medium':scannerVM.volatility == 'Mid', 'low':scannerVM.volatility == 'Low'}">
                              {{scannerVM.tp}} vol
                           </div>
                        </ng-template>
                     </data-table-cell>
                     <data-table-cell columnName="time">
                        <ng-template let-scannerVM>
                           <div class="cell-data">
                              {{scannerVM.time}}
                           </div>
                        </ng-template>
                     </data-table-cell>
                  </data-table>
               </div>
            </div>
         </mat-tab>
      </mat-tab-group>
   </div>
</div>

<ng-template #outOfAccess>
   <div class="out-of-access" (click)="processCheckout()">
      <div class="image">
         <img class="BFTimage" src="assets/img/bftnavigatorlogo.svg">
      </div>
      <div class="text">
         Upgrade your subscription to get access to Sonar.
      </div>
   </div>
</ng-template>

<bft-loader *ngIf="loading && isAuthorizedCustomer"></bft-loader>