<ng-container *ngIf="hasAccess; else outOfAccess">
    <div class="root">
        <div class="header-line">
           
            <div class="left-side">
                <div *ngIf="!!myAutoTradingAccount && !!userAutoTradingInfoData" class="account-id">Agent: <span
                        class="mobilehiddenacc">#{{myAutoTradingAccount}}</span></div>
            </div>
            <div class="right-side">
                <mat-slide-toggle [(ngModel)]="advancedView">God View</mat-slide-toggle>

                <div *ngIf="!!myAutoTradingAccount && !!userAutoTradingInfoData">
                    <span (click)="changeUseManualTradingForAccount()" *ngIf="!userAutoTradingInfoData.useManualTrading"
                        class="change-trading-mode">
                        <div class="trading-enabled">
                            <span *ngIf="userAutoTradingInfoData.useManualTrading" class="positive-color">HITL
                                Enabled</span>
                            <span *ngIf="!userAutoTradingInfoData.useManualTrading" class="negative-color">HITL
                                Disabled</span>
                        </div>
                    </span>
                    <span (click)="changeUseManualTradingForAccount()" *ngIf="userAutoTradingInfoData.useManualTrading"
                        class="change-trading-mode">
                        <div class="trading-enabled">
                            <span *ngIf="userAutoTradingInfoData.useManualTrading" class="positive-color">HITL
                                Enabled</span>
                            <span *ngIf="!userAutoTradingInfoData.useManualTrading" class="negative-color">HITL
                                Disabled</span>
                        </div>
                    </span>
                </div>
                <div class="extended-mode" (click)="setExtendedMode()">
                    <div>{{extendedMode ? "Group States " : "Frequency States"}}</div>
                </div>
            </div>
        </div>
        <div class="chart-view" *ngIf="!!chartDataBars">
            <div class="chart-container">
                <div class="chart-container-titlex ">
                    <div>
                        <div class="bold-symbol">{{chartDataBars.symbol}}</div>
                    </div>
                    <div class="hidden">{{ formatDateToShortForm(chartDataBars.startDate) }}
                        - {{ formatDateToShortForm(chartDataBars.endDate) }} </div>
                    <div><span class="close-icon" (click)="closeCharts()"><i class="fa fa-close iconsize"></i></span>
                    </div>
                </div>
                <!--  <div class="chart-container-canvas">
                <trend-index-bar-chart [data]="chartDataBars.data" [height]="90"></trend-index-bar-chart>
            </div>-->
            </div>
            <ng-container *ngFor="let chartDataTrend of chartDataTrends">
                <div class="chart-container" [ngClass]="height-60">
                    <div class="charts-container">
                        <div class="chart-container-title">
                            <div class="datatrend">{{chartDataTrend.timeframe}}</div>
                        </div>
                        <div class="chart-item">
                            <div class="chart-container-title strength">
                                <div [class.strength-positive]="chartDataTrend.strength > 0"
                                    [class.strength-negative]="chartDataTrend.strength < 0">
                                    Strength {{chartDataTrend.strength > 0 ? "+"
                                    :""}}{{chartDataTrend.strength.toFixed(0)}}%</div>
                                <div class="phase-title">{{chartDataTrend.phase}}</div>
                            </div>
                            <trend-index-chart [data]="chartDataTrend.strengthChart" [height]="60"></trend-index-chart>
                        </div>

                    </div>

                </div>
            </ng-container>
            <ng-container *ngFor="let chartDataTrend of chartDataTrends">
                <div class="chart-container" [ngClass]="height-60">
                    <div class="charts-container">
                        <div class="chart-container-title">
                            <div class="datatrend">{{chartDataTrend.timeframe}}</div>
                        </div>

                        <div class="chart-item" *ngIf="chartDataTrend.volatilityChart.values.length > 0 ">
                            <div class="chart-container-title vol">
                                <div> Volatility </div>
                            </div>
                            <trend-index-chart [data]="chartDataTrend.volatilityChart"
                                [height]="60"></trend-index-chart>
                        </div>
                    </div>

                </div>
            </ng-container>
        </div>
        <div class="data-table">
            <data-table #dataTableComponent [rows]="vm" [selectable]="true" [selectedRow]="selectedVM"
                [columnCaption]="columnCaption" [allowColumnsVisibilityChange]="false" [trackByIndex]="false"
                [groups]="groups" [groupingField]="groupingField"
                [hiddenColumns]="['driver', 'min_1', 'min_5', 'min_15', 'h_1', 'h_4', 'd_1', 'month_1', 'year_1', 'year_10']"
                (onRowSelect)="instrumentSelect($event)" (onRowClick)="rowClicked($event)"
                (onDoubleClick)="doubleClicked($event)" (onContextMenuSelected)="handleContextMenuSelected($event)" [ngClass]="{'god-view': advancedView}">

                <!--Columns-->

                <data-table-header-cell columnName="symbol" [sortable]="false" [columnMinWidth]="editMode ? 255 : 255"
                [columnWidth]="editMode ? 255 : 255">
                    Market State
                </data-table-header-cell>
                <data-table-header-cell columnName="driver" [sortable]="false" [columnMinWidth]="15" [columnWidth]="75">
                    {{'driver' | translate}}
                </data-table-header-cell>
                <data-table-header-cell columnName="min_1" [sortable]="false" [columnMinWidth]="15" [columnWidth]="75">
                    {{'min_1' | translate}}
                </data-table-header-cell>
                <data-table-header-cell columnName="min_5" [sortable]="false" [columnMinWidth]="15" [columnWidth]="75">
                    {{'min_5' | translate}}
                </data-table-header-cell>
                <data-table-header-cell columnName="min_15" [sortable]="false" [columnMinWidth]="15" [columnWidth]="75">
                    {{'min_15' | translate}}
                </data-table-header-cell>
                <data-table-header-cell columnName="h_1" [sortable]="false" [columnMinWidth]="15" [columnWidth]="75">
                    {{'h_1' | translate}}
                </data-table-header-cell>
                <data-table-header-cell columnName="h_4" [sortable]="false" [columnMinWidth]="15" [columnWidth]="75">
                    {{'h_4' | translate}}
                </data-table-header-cell>
                <data-table-header-cell columnName="d_1" [sortable]="false" [columnMinWidth]="15" [columnWidth]="75">
                    {{'d_1' | translate}}
                </data-table-header-cell>
                <data-table-header-cell columnName="month_1" [sortable]="false" [columnMinWidth]="15"
                    [columnWidth]="75">
                    {{'month_1' | translate}}
                </data-table-header-cell>
                <data-table-header-cell columnName="year_1" [sortable]="false" [columnMinWidth]="15" [columnWidth]="75">
                    {{'year_1' | translate}}
                </data-table-header-cell>
                <data-table-header-cell columnName="year_10" [sortable]="false" [columnMinWidth]="15"
                    [columnWidth]="75">
                    {{'year_10' | translate}}
                </data-table-header-cell>

                <data-table-header-cell columnName="short_g" [sortable]="false" [columnMinWidth]="15">
                    {{'short_g' | translate}}
                </data-table-header-cell>
                <data-table-header-cell columnName="mid_g" [sortable]="false" [columnMinWidth]="15">
                    {{'mid_g' | translate}}
                </data-table-header-cell>
                <data-table-header-cell columnName="long_g" [sortable]="false" [columnMinWidth]="15">
                    {{'long_g' | translate}}
                </data-table-header-cell>

                <!-- Cells -->
                <data-table-cell columnName="symbol">
                    <ng-template let-vmItem>
                        <div class="symbol-cell">
                            <div class="symbol-container">
                                <span class="symbolx-border"
                                    [ngClass]="{'positive-border': vmItem.totalStrength > 0, 'negative-border': vmItem.totalStrength < 0}">
                                </span>
                                <div class="symbol-color-container">
                                    <div class="symbolholdx">
                                        <div class="middlesymbol">
                                            <div class="symbol-holder-real-OG">
                                            <div class="symbolx" *ngIf="!advancedView"   [ngClass]="getRelativeStrengthClass(vmItem.totalStrength)">
                                                {{vmItem.symbol}} <span> {{(vmItem.totalStrength * 100).toFixed(0)}}%</span>
                                            </div>
                                            <div class="symbolx" *ngIf="advancedView"   [ngClass]="getRelativeStrengthClass(vmItem.totalStrength)">
                                                {{vmItem.symbol}} <span> {{(vmItem.totalStrength * 100).toFixed(0)}}%</span>
                                            </div>
                                        </div>
                                            <div class="symbol-title-container">

                                                <div class="status-runner" [ngClass]="{'active-auto-mode': isTradable(vmItem)}">
                                                <div class="symbolxholder symbolxholder-hover" (click)="instrumentSelectionChanged(vmItem, $event)">
                                                    <div class="containerx">
                                                        <div class="sphere">
                                                            <div class="cube untradeable" *ngIf="!isTradable(vmItem)">
                                                            </div>
                                                            <div class="cube untradeable-all"  *ngIf="vmItem.tradingState == 0">
                                                            </div>
                                                            <div class="cube tradeable" *ngIf="isTradable(vmItem)"
                                                                [class.is-auto-selectedx]="isAutoSelected(vmItem)">
                                                            </div>
                                                            <div class="cube selected"
                                                                *ngIf="isInstrumentSelected(vmItem) && !isTradable(vmItem)">
                                                            </div>
                                                        </div>
                                                        <div class="half-cube top-half"
                                                            *ngIf="isTradable(vmItem) && !editMode"
                                                            [class.is-auto-selectedx]="isAutoSelected(vmItem)"></div>
                                                        <div class="half-cube bottom-half"
                                                            *ngIf="isTradable(vmItem) && !editMode"
                                                            [class.is-auto-selectedx]="isAutoSelected(vmItem)"></div>
                                                    </div>
                               
                                                    <div class="containerx-status">
                                                        <div class="status-holder">
                                                            <div *ngIf="!isTradable(vmItem)">
                                                                Waiting
                                                            </div>
                                                            <div  *ngIf="isTradable(vmItem)"
                                                                [class.is-auto-selectedx]="isAutoSelected(vmItem)">
                                                                Active
                                                            </div>
                                                            <!-- <div
                                                                *ngIf="isInstrumentSelected(vmItem) && !isTradable(vmItem)">
                                                               HITL Active
                                                            </div> -->
                                                          
                                                        </div>
                                                    </div>
                                                </div>

                                                  </div>

                                                  

                                                <div class="HITL active" *ngIf="isInstrumentSelected(vmItem)">HITL Active</div>

                                                  <div class="HITL available" *ngIf="vmItem.tradingState == 1 && !isInstrumentSelected(vmItem)">HITL</div>

                       
                                              
                                               
                                               
                                              
                                                <div class="symbol-trade-state" [class.hidden]="!advancedView">
                                                    <i class="fa fa-heart-pulse" *ngIf="vmItem.tradingState == 3 || vmItem.tradingState == 4"></i>
                                                    <i class="fa fa-star" *ngIf="vmItem.tradingState == 2"></i>
                                                    <i class="fa fa-hexagon-exclamation" *ngIf="vmItem.tradingState == 0"></i>
                                                </div>
                                            </div>
                                      
                                    
                                            <span class="strength-total" [class.up-trend]="vmItem.totalStrength > 0"
                                                [class.down-trend]="vmItem.totalStrength < 0"    *ngIf="advancedView">
                                                Strength: [{{(vmItem.totalStrength * 100).toFixed(0)}}%]
                                            </span>
                                            <span class="details-btn" *ngIf="advancedView">
                                                State: {{vmItem.currentMarketState}}
                                            </span>
                                            <span class="expected-market-state" *ngIf="advancedView">
                                                Next > {{vmItem.expectedMarketState}}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                </data-table-cell>
                <data-table-cell columnName="driver">
                    <ng-template let-vmItem>
                        <div class="strength-cell">
                            <trend-column  [advancedView]="advancedView" [Strength]="vmItem.price1Strength"
                                [StrengthValue]="vmItem.price1StrengthValue"
                                [VolatilityValue]="vmItem.price1VolatilityValue"
                                [Duration]="vmItem.driveDuration"></trend-column>
                        </div>
                    </ng-template>
                </data-table-cell>
                <data-table-cell columnName="min_1">
                    <ng-template let-vmItem>
                        <div class="strength-cell">
                            <trend-column  [advancedView]="advancedView" [Strength]="vmItem.price60Strength"
                                [StrengthValue]="vmItem.price60StrengthValue" [TrendState]="vmItem.minute1State"
                                [TrendPhase]="vmItem.minute1Phase" [VolatilityValue]="vmItem.price60VolatilityValue"
                                [Duration]="vmItem.minute1Duration"></trend-column>
                        </div>
                    </ng-template>
                </data-table-cell>
                <data-table-cell columnName="min_5">
                    <ng-template let-vmItem>
                        <div class="strength-cell">
                            <trend-column  [advancedView]="advancedView" [Strength]="vmItem.price300Strength"
                                [StrengthValue]="vmItem.price300StrengthValue" [TrendState]="vmItem.minute5State"
                                [TrendPhase]="vmItem.minute5Phase" [VolatilityValue]="vmItem.price300VolatilityValue"
                                [Duration]="vmItem.minute5Duration"></trend-column>
                        </div>
                    </ng-template>
                </data-table-cell>
                <data-table-cell columnName="min_15">
                    <ng-template let-vmItem>
                        <div class="strength-cell">
                            <trend-column  [advancedView]="advancedView" [Strength]="vmItem.price900Strength"
                                [StrengthValue]="vmItem.price900StrengthValue" [TrendState]="vmItem.minute15State"
                                [TrendPhase]="vmItem.minute15Phase" [VolatilityValue]="vmItem.price900VolatilityValue"
                                [Duration]="vmItem.minute15Duration"></trend-column>
                        </div>
                    </ng-template>
                </data-table-cell>
                <data-table-cell columnName="h_1">
                    <ng-template let-vmItem>
                        <div class="strength-cell">
                            <trend-column  [advancedView]="advancedView" [Strength]="vmItem.price3600Strength"
                                [StrengthValue]="vmItem.price3600StrengthValue" [TrendState]="vmItem.hour1State"
                                [TrendPhase]="vmItem.hour1Phase" [VolatilityValue]="vmItem.price3600VolatilityValue"
                                [Duration]="vmItem.hour1Duration"></trend-column>
                        </div>
                    </ng-template>
                </data-table-cell>
                <data-table-cell columnName="h_4">
                    <ng-template let-vmItem>
                        <div class="strength-cell">
                            <trend-column  [advancedView]="advancedView" [Strength]="vmItem.price14400Strength"
                                [StrengthValue]="vmItem.price14400StrengthValue" [TrendState]="vmItem.hour4State"
                                [TrendPhase]="vmItem.hour4Phase" [VolatilityValue]="vmItem.price14400VolatilityValue"
                                [Duration]="vmItem.hour4Duration"></trend-column>
                        </div>
                    </ng-template>
                </data-table-cell>
                <data-table-cell columnName="d_1">
                    <ng-template let-vmItem>
                        <div class="strength-cell">
                            <trend-column  [advancedView]="advancedView" [Strength]="vmItem.price86400Strength"
                                [StrengthValue]="vmItem.price86400StrengthValue" [TrendState]="vmItem.dailyState"
                                [TrendPhase]="vmItem.dailyPhase" [VolatilityValue]="vmItem.price86400VolatilityValue"
                                [Duration]="vmItem.dailyDuration"></trend-column>
                        </div>
                    </ng-template>
                </data-table-cell>
                <data-table-cell columnName="month_1">
                    <ng-template let-vmItem>
                        <div class="strength-cell">
                            <trend-column  [advancedView]="advancedView" [Strength]="vmItem.price2592000Strength"
                                [StrengthValue]="vmItem.price2592000StrengthValue" [TrendState]="vmItem.monthlyState"
                                [TrendPhase]="vmItem.monthlyPhase"
                                [VolatilityValue]="vmItem.price2592000VolatilityValue"
                                [Duration]="vmItem.monthlyDuration"></trend-column>
                        </div>
                    </ng-template>
                </data-table-cell>
                <data-table-cell columnName="year_1">
                    <ng-template let-vmItem>
                        <div class="strength-cell">
                            <trend-column  [advancedView]="advancedView" [Strength]="vmItem.price31104000Strength"
                                [StrengthValue]="vmItem.price31104000StrengthValue" [TrendPhase]="vmItem.yearlyPhase"
                                [TrendState]="vmItem.yearlyState"
                                [VolatilityValue]="vmItem.price31104000VolatilityValue"></trend-column>
                        </div>
                    </ng-template>
                </data-table-cell>
                <data-table-cell columnName="year_10">
                    <ng-template let-vmItem>
                        <div class="strength-cell">
                            <trend-column  [advancedView]="advancedView" [Strength]="vmItem.price311040000Strength"
                                [StrengthValue]="vmItem.price311040000StrengthValue" [TrendPhase]="vmItem.year10Phase"
                                [TrendState]="vmItem.year10State"
                                [VolatilityValue]="vmItem.price311040000VolatilityValue"></trend-column>
                        </div>
                    </ng-template>
                </data-table-cell>


                <data-table-cell columnName="short_g">
                    <ng-template let-vmItem>
                        <div class="strength-cell">
                            <trend-column  [advancedView]="advancedView" [Strength]="vmItem.shortGroupStrength"
                                [StrengthValue]="vmItem.shortGroupStrengthValue" [TrendPhase]="vmItem.shortGroupPhase"
                                [VolatilityValue]="vmItem.shortGroupVolatilityValue"
                                [Duration]="vmItem.shortGroupDuration"></trend-column>
                        </div>
                    </ng-template>
                </data-table-cell>
                <data-table-cell columnName="mid_g">
                    <ng-template let-vmItem>
                        <div class="strength-cell">
                            <trend-column  [advancedView]="advancedView" [Strength]="vmItem.midGroupStrength"
                                [StrengthValue]="vmItem.midGroupStrengthValue" [TrendPhase]="vmItem.midGroupPhase"
                                [VolatilityValue]="vmItem.midGroupVolatilityValue"
                                [Duration]="vmItem.midGroupDuration"></trend-column>
                        </div>
                    </ng-template>
                </data-table-cell>
                <data-table-cell columnName="long_g">
                    <ng-template let-vmItem>
                        <div class="strength-cell">
                            <trend-column  [advancedView]="advancedView" [Strength]="vmItem.longGroupStrength"
                                [StrengthValue]="vmItem.longGroupStrengthValue" [TrendPhase]="vmItem.longGroupPhase"
                                [VolatilityValue]="vmItem.longGroupVolatilityValue"
                                [Duration]="vmItem.longGroupDuration"></trend-column>
                        </div>
                    </ng-template>
                </data-table-cell>

                <data-table-menu-item [id]="'trade'">
                    <ng-template>
                        {{isSelectedInstrumentTradable() ? "Disable HITL" : "Enable HITL"}}
                    </ng-template>
                </data-table-menu-item>

                <data-table-menu-item [id]="'openCharts'">
                    <ng-template>
                        View Analysis
                    </ng-template>
                </data-table-menu-item>
                <data-table-menu-item [id]="'viewOnChart'">
                    <ng-template>
                        View Chart
                    </ng-template>
                </data-table-menu-item>


            </data-table>
        </div>
    </div>

    <bft-loader *ngIf="loading"></bft-loader>
</ng-container>

<ng-template #outOfAccess>
    <div class="out-of-access" (click)="processCheckout()">
        <div class="out-of-access-box">
            <div class="image">
                <img class="BFTimage" src="assets/img/bftnavigatorlogo.svg">
            </div>
            <div class="text">
                Upgrade your subscription to get access to Trend Index.
            </div>
        </div>
    </div>
</ng-template>